<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Demo Hệ Quản Trị Cơ Sở Dữ Liệu - Quản lý Thư viện</title>
  <style>
    body{font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:#f4f6f8; color:#111}
    .container{max-width:1100px;margin:20px auto;padding:18px}
    .card{background:white;border-radius:10px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
    header h1{margin:0;font-size:20px}
    .layout{display:grid;grid-template-columns:220px 1fr 360px;gap:14px;margin-top:14px}
    .table-list button{display:block;width:100%;text-align:left;padding:8px;border-radius:6px;border:1px solid transparent;background:transparent;margin-bottom:8px}
    .table-list button.active{background:#eef7ff;border-color:#cfe9ff}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #e6e9ee;padding:6px;text-align:left;font-size:13px}
    .top-actions{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    input[type=text], textarea{width:100%;padding:8px;border:1px solid #d5dbe6;border-radius:6px;font-size:13px}
    .btn{padding:8px 10px;border-radius:6px;border:0;cursor:pointer}
    .btn.primary{background:#2b87ff;color:white}
    .btn.gray{background:#f0f2f5}
    .logs{max-height:260px;overflow:auto;font-size:13px;background:#fbfdff;padding:8px;border-radius:6px;border:1px solid #eef5ff}
    .small{font-size:13px;color:#556}
    pre{white-space:pre-wrap;background:#fafafa;padding:8px;border-radius:6px;border:1px solid #eee;font-size:13px}
    form .inputs{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px}
    footer{margin-top:14px;font-size:13px;color:#334}
    .stats{margin-top:10px;background:#f9fbff;padding:8px;border-radius:6px;border:1px solid #eef5ff;font-size:13px}
    .muted{color:#667}
    code{background:#fff;padding:2px 4px;border-radius:4px;border:1px solid #eee;font-size:12px}
  </style>
</head>
<body>
  <div class="container">
    <header class="card">
      <h1>Demo Hệ Quản Trị Cơ Sở Dữ Liệu - Quản lý Thư viện</h1>
      <div class="small">Phiên bản chạy trực tiếp trong trình duyệt. Mục đích: minh họa GIỚI THIỆU CÁC HỆ CƠ SỞ DỮ LIỆU, CRUD, truy vấn đơn giản, thống kê và báo cáo.</div>
    </header>

    <div class="layout">
      <aside class="card table-list" id="sidebar">
        <h3>Danh sách bảng</h3>
        <div id="tables"></div>
        <details style="margin-top:8px">
          <summary>Gợi ý</summary>
          <div class="small" style="margin-top:6px">Bảng chính: NGUOI_DOC, SACH, MUON_TRA. Chọn bảng để xem, thêm/sửa/xóa. Thử truy vấn SELECT. Dùng Thống kê / Lập báo cáo để minh họa.</div>
        </details>
      </aside>

      <main class="card" id="main">
        <div id="table-view">
          <h3 id="table-name">Bảng: -</h3>
          <div class="small" id="schema"></div>
          <div style="margin-top:10px;overflow:auto;max-height:320px">
            <table id="data-table"><thead></thead><tbody></tbody></table>
          </div>

          <form id="add-form" style="margin-top:12px">
            <h4>Thêm bản ghi</h4>
            <div class="inputs" id="add-inputs"></div>
            <div style="margin-top:8px">
              <button class="btn primary" type="submit">Thêm</button>
            </div>
          </form>
        </div>
      </main>

      <aside class="card">
        <h3>Truy vấn & nhật ký</h3>
        <div style="margin-top:8px">
          <textarea id="query" rows="4">SELECT * FROM NGUOI_DOC</textarea>
          <div class="top-actions">
            <button class="btn primary" id="run">Chạy truy vấn</button>
            <button class="btn gray" id="sample1">Mẫu WHERE</button>
            <button class="btn gray" id="sample2">Chọn cột</button>
            <button class="btn gray" id="statsBtn" title="Tính thống kê cho bảng đang chọn">Thống kê</button>
            <button class="btn" id="reportBtn" title="Tạo báo cáo HTML và .txt cho bảng đang chọn">Lập báo cáo</button>
          </div>
        </div>

        <div style="margin-top:10px">
          <h4>Execution plan (mô phỏng)</h4>
          <div id="plan" class="small" style="min-height:50px;background:#fff;padding:8px;border-radius:6px;border:1px solid #eee"></div>
        </div>

        <div style="margin-top:10px">
          <h4>Kết quả</h4>
          <pre id="result">Chưa có kết quả.</pre>
        </div>

        <div style="margin-top:10px">
          <h4>Thống kê</h4>
          <div id="stats" class="stats">Chưa có thống kê. Nhấn "Thống kê" để xem.</div>
        </div>

        <div style="margin-top:10px">
          <h4>Lập báo cáo</h4>
          <div class="report-actions">
            <button class="btn primary" id="generateHtmlReport">Xuất báo cáo HTML</button>
            <button class="btn gray" id="generateTxtReport">Tải báo cáo .txt</button>
            <button class="btn" id="downloadDB">Tải bản sao DB (.json)</button>
          </div>
          <div style="margin-top:8px" class="small muted">Báo cáo sẽ chứa: tên bảng, schema, danh sách bản ghi và kết quả thống kê cùng thời gian tạo.</div>
        </div>

        <div style="margin-top:10px">
          <h4>Nhật ký hoạt động</h4>
          <div class="logs" id="logs"></div>
        </div>
      </aside>
    </div>

    <footer class="card small">
      Hướng dẫn: Thực hành CRUD trên bảng, thử viết truy vấn SELECT. Hệ thống hỗ trợ cú pháp đơn giản: <code>SELECT &lt;cols|*&gt; FROM &lt;Table&gt; [WHERE col=value [AND col='value']]</code>.
    </footer>
  </div>

<script>
// DATABASE: cấu trúc quản lý thư viện
const DB = {
  NGUOI_DOC: {
    schema: ['so_the_TV','ho_ten','ngay_sinh','lop'],
    rows: [
      {so_the_TV:'TV001',ho_ten:'Nguyễn Thị A',ngay_sinh:'2006-05-12',lop:'12A1'},
      {so_the_TV:'TV002',ho_ten:'Trần Văn B',ngay_sinh:'2007-02-20',lop:'11B3'},
      {so_the_TV:'TV003',ho_ten:'Lê Minh C',ngay_sinh:'2008-01-01',lop:'10A5'},
      {so_the_TV:'TV004',ho_ten:'Phạm Thu D',ngay_sinh:'2007-11-25',lop:'11B2'},
      {so_the_TV:'TV005',ho_ten:'Hoàng Đức E',ngay_sinh:'2006-08-15',lop:'12A3'},
      {so_the_TV:'TV006',ho_ten:'Đặng Thị F',ngay_sinh:'2008-04-10',lop:'10C1'},
      {so_the_TV:'TV007',ho_ten:'Võ Thành G',ngay_sinh:'2007-09-03',lop:'11B3'},
      {so_the_TV:'TV008',ho_ten:'Bùi Văn H',ngay_sinh:'2006-12-28',lop:'12A1'},
      {so_the_TV:'TV009',ho_ten:'Cao Thị I',ngay_sinh:'2008-03-19',lop:'10A5'},
      {so_the_TV:'TV010',ho_ten:'Phan Duy K',ngay_sinh:'2007-06-07',lop:'11B2'},
      {so_the_TV:'TV011',ho_ten:'Trịnh Lan L',ngay_sinh:'2006-10-14',lop:'12A3'},
      {so_the_TV:'TV012',ho_ten:'Khuất Hữu M',ngay_sinh:'2008-07-30',lop:'10C1'}
    ]
  },
  SACH: {
    schema: ['ma_sach','ten_sach','so_trang','tac_gia'],
    rows: [
      {ma_sach:'S001',ten_sach:'Hóa học 11',so_trang:220,tac_gia:'Nguyễn Văn X'},
      {ma_sach:'S002',ten_sach:'Toán nâng cao',so_trang:312,tac_gia:'Lê Thị Y'},
      {ma_sach:'S003',ten_sach:'Vật lý đại cương',so_trang:450,tac_gia:'Phạm Đức Z'},
      {ma_sach:'S004',ten_sach:'Lịch sử Việt Nam',so_trang:380,tac_gia:'Trần A'},
      {ma_sach:'S005',ten_sach:'Tin học cơ bản',so_trang:280,tac_gia:'Bùi B'},
      {ma_sach:'S006',ten_sach:'Ngữ văn 12',so_trang:250,tac_gia:'Đặng C'},
      {ma_sach:'S007',ten_sach:'Địa lý kinh tế',so_trang:330,tac_gia:'Võ D'},
      {ma_sach:'S008',ten_sach:'Sinh học phân tử',so_trang:510,tac_gia:'Hoàng E'},
      {ma_sach:'S009',ten_sach:'Tiếng Anh IELTS',so_trang:400,tac_gia:'Nguyễn F'},
      {ma_sach:'S010',ten_sach:'Giáo dục công dân',so_trang:180,tac_gia:'Lê G'},
      {ma_sach:'S011',ten_sach:'Triết học nhập môn',so_trang:560,tac_gia:'Phạm H'}
    ]
  },
  MUON_TRA: {
    schema: ['so_the_TV','ma_sach','ngay_muon','ngay_tra'],
    rows: [
      {so_the_TV:'TV001',ma_sach:'S001',ngay_muon:'2025-11-01',ngay_tra:'2025-11-10'},
      {so_the_TV:'TV002',ma_sach:'S002',ngay_muon:'2025-11-05',ngay_tra:null},
      {so_the_TV:'TV001',ma_sach:'S003',ngay_muon:'2025-11-01',ngay_tra:'2025-11-10'},
      {so_the_TV:'TV003',ma_sach:'S004',ngay_muon:'2025-11-15',ngay_tra:'2025-11-25'},
      {so_the_TV:'TV004',ma_sach:'S005',ngay_muon:'2025-11-18',ngay_tra:null},
      {so_the_TV:'TV005',ma_sach:'S001',ngay_muon:'2025-11-20',ngay_tra:'2025-12-01'},
      {so_the_TV:'TV006',ma_sach:'S006',ngay_muon:'2025-11-22',ngay_tra:'2025-12-05'},
      {so_the_TV:'TV007',ma_sach:'S007',ngay_muon:'2025-11-25',ngay_tra:null},
      {so_the_TV:'TV008',ma_sach:'S008',ngay_muon:'2025-11-28',ngay_tra:'2025-12-10'},
      {so_the_TV:'TV009',ma_sach:'S009',ngay_muon:'2025-12-01',ngay_tra:null},
      {so_the_TV:'TV010',ma_sach:'S010',ngay_muon:'2025-12-05',ngay_tra:'2025-12-15'},
      {so_the_TV:'TV002',ma_sach:'S003',ngay_muon:'2025-12-08',ngay_tra:null},
      {so_the_TV:'TV004',ma_sach:'S006',ngay_muon:'2025-12-10',ngay_tra:null},
      {so_the_TV:'TV011',ma_sach:'S011',ngay_muon:'2025-12-12',ngay_tra:'2025-12-20'},
      {so_the_TV:'TV012',ma_sach:'S002',ngay_muon:'2025-12-15',ngay_tra:null}
    ]
  }
};

// State
let selectedTable = 'NGUOI_DOC';
const logsEl = document.getElementById('logs');
const planEl = document.getElementById('plan');
const resultEl = document.getElementById('result');
const statsEl = document.getElementById('stats');

function log(msg){
  const time = new Date().toLocaleString();
  logsEl.innerHTML = `<div>- [${escapeHtml(time)}] ${escapeHtml(msg)}</div>` + logsEl.innerHTML;
}
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function renderTables(){
  const area = document.getElementById('tables');
  area.innerHTML = '';
  Object.keys(DB).forEach(t=>{
    const btn = document.createElement('button');
    btn.textContent = t + ' ('+DB[t].rows.length+' bản ghi)';
    btn.className = (t===selectedTable?'active':'') + '';
    btn.onclick = ()=>{ selectedTable=t; renderMain(); renderTables(); };
    if(t===selectedTable) btn.classList.add('active');
    area.appendChild(btn);
  });
}

function renderMain(){
  const tbl = DB[selectedTable];
  document.getElementById('table-name').textContent = 'Bảng: ' + selectedTable;
  document.getElementById('schema').textContent = 'Schema: ' + tbl.schema.join(', ');

  const thead = document.querySelector('#data-table thead');
  const tbody = document.querySelector('#data-table tbody');
  thead.innerHTML = ''; tbody.innerHTML = '';
  const trh = document.createElement('tr');
  tbl.schema.forEach(col=>{
    const th = document.createElement('th'); th.textContent = col; trh.appendChild(th);
  });
  const thAct = document.createElement('th'); thAct.textContent = 'Hành động'; trh.appendChild(thAct);
  thead.appendChild(trh);

  tbl.rows.forEach((r, idx)=>{
    const tr = document.createElement('tr');
    tbl.schema.forEach(col=>{
      const td = document.createElement('td'); td.textContent = (r[col]===null||r[col]===undefined)?'':r[col]; tr.appendChild(td);
    });
    const tdAct = document.createElement('td');
    const edit = document.createElement('button'); edit.textContent='Sửa'; edit.className='btn gray'; edit.onclick=()=>editRow(idx);
    const del = document.createElement('button'); del.textContent='Xóa'; del.className='btn'; del.style.marginLeft='6px'; del.onclick=()=>deleteRow(idx);
    tdAct.appendChild(edit); tdAct.appendChild(del); tr.appendChild(tdAct);
    tbody.appendChild(tr);
  });

  renderAddForm();
  statsEl.textContent = 'Chưa có thống kê. Nhấn "Thống kê" để xem.';
}

function renderAddForm(){
  const container = document.getElementById('add-inputs'); container.innerHTML='';
  const schema = DB[selectedTable].schema;
  schema.forEach(col=>{
    const inp = document.createElement('input'); inp.type='text'; inp.placeholder=col; inp.name=col;
    container.appendChild(inp);
  });
}

document.getElementById('add-form').addEventListener('submit', function(e){
  e.preventDefault();
  const inputs = Array.from(this.querySelectorAll('input'));
  const row = {};
  inputs.forEach(inp=>{
    let v = inp.value.trim();
    if(v==='') v = null;
    if(v!==null && !isNaN(Number(v))) v = Number(v);
    row[inp.name] = v;
  });
  DB[selectedTable].rows.push(row);
  saveDB();
  log('Thêm bản ghi vào ' + selectedTable);
  renderMain();
});

function editRow(index){
  const tbl = DB[selectedTable];
  const rec = tbl.rows[index];
  if(!rec) return alert('Không tìm thấy bản ghi');
  tbl.schema.forEach(col=>{
    const newv = prompt('Giá trị cho ' + col, rec[col]===null||rec[col]===undefined?'':rec[col]);
    if(newv!==null){
      rec[col] = newv===''?null:(!isNaN(Number(newv))?Number(newv):newv);
    }
  });
  log('Cập nhật bản ghi tại vị trí ' + (index+1) + ' trong ' + selectedTable);
  saveDB();
  renderMain();
}

function deleteRow(index){
  if(!confirm('Xác nhận xóa bản ghi thứ ' + (index+1) + ' từ ' + selectedTable + '?')) return;
  DB[selectedTable].rows.splice(index,1);
  saveDB();
  log('Xóa bản ghi thứ ' + (index+1) + ' từ ' + selectedTable);
  renderMain();
}

// Simple SQL-like parser & runner (SELECT ... FROM ... [WHERE ...])
function runQuery(raw){
  planEl.textContent = ''; resultEl.textContent = '';
  const q = raw.trim();
  log('Thực thi truy vấn: ' + q);
  const m = q.match(/^SELECT\s+(.+)\s+FROM\s+(\w+)(?:\s+WHERE\s+(.+))?$/i);
  if(!m){ const err='Cú pháp không hợp lệ. Ví dụ: SELECT * FROM NGUOI_DOC WHERE so_the_TV=TV001'; planEl.textContent=err; resultEl.textContent='Lỗi'; return; }
  const colsRaw = m[1].trim();
  const tableName = m[2].trim();
  const whereRaw = m[3]?m[3].trim():null;
  if(!DB[tableName]){ planEl.textContent = `Bảng '${tableName}' không tồn tại.`; return; }

  const plan = [];
  plan.push('1) Tìm bảng: ' + tableName);
  plan.push('2) Đọc tất cả dòng từ bảng');
  if(whereRaw) plan.push('3) Lọc theo điều kiện: ' + whereRaw);
  if(colsRaw !== '*') plan.push('4) Chọn cột: ' + colsRaw);
  planEl.innerHTML = plan.map(p=>escapeHtml(p)).join('<br/>');

  let rows = DB[tableName].rows.slice();
  if(whereRaw){
    const conds = whereRaw.split(/\s+AND\s+/i).map(s=>s.trim());
    rows = rows.filter(r=>{
      return conds.every(c=>{
        const parts = c.split('=');
        if(parts.length!==2) return false;
        const col = parts[0].trim();
        let val = parts[1].trim();
        if((val.startsWith("'") && val.endsWith("'")) || (val.startsWith('"') && val.endsWith('"'))){
          val = val.slice(1,-1);
        }
        const num = Number(val);
        const compare = isNaN(num)?val:num;
        return r[col] == compare;
      });
    });
  }

  let out = rows.map(r=>Object.assign({},r));
  if(colsRaw !== '*'){
    const cols = colsRaw.split(',').map(c=>c.trim());
    out = out.map(r=>{
      const o={};
      cols.forEach(c=>o[c]=r[c]);
      return o;
    });
  }

  resultEl.textContent = JSON.stringify(out, null, 2);
}

// Statistics and reports

function detectNumericColumns(tableName){
  const tbl = DB[tableName];
  const numericCols = [];
  tbl.schema.forEach(col=>{
    let hasNumeric = false;
    let hasNonNumeric = false;
    tbl.rows.forEach(r=>{
      const v = r[col];
      if(v===null || v===undefined) return;
      if(typeof v === 'number') hasNumeric = true;
      else if(!isNaN(Number(v))) hasNumeric = true;
      else hasNonNumeric = true;
    });
    if(hasNumeric && !hasNonNumeric) numericCols.push(col);
  });
  return numericCols;
}

function computeStats(tableName){
  const tbl = DB[tableName];
  const count = tbl.rows.length;
  const numericCols = detectNumericColumns(tableName);
  const stats = { table: tableName, count, numeric: {} };
  numericCols.forEach(col=>{
    const vals = tbl.rows.map(r=> {
      const v = r[col];
      if(v===null || v===undefined) return null;
      return typeof v === 'number' ? v : (isNaN(Number(v)) ? null : Number(v));
    }).filter(v=>v!==null);
    if(vals.length===0){
      stats.numeric[col] = { count:0 };
    } else {
      const sum = vals.reduce((s,x)=>s+x,0);
      const avg = sum/vals.length;
      const min = Math.min(...vals);
      const max = Math.max(...vals);
      stats.numeric[col] = { count: vals.length, avg, min, max, sum };
    }
  });
  return stats;
}

function renderStatsToUI(stats){
  if(!stats) { statsEl.textContent = 'Không có thống kê.'; return; }
  const lines = [];
  lines.push(`<strong>Bảng:</strong> ${escapeHtml(stats.table)}`);
  lines.push(`<strong>Tổng số bản ghi:</strong> ${stats.count}`);
  if(Object.keys(stats.numeric).length===0){
    lines.push(`<em>Không tìm thấy trường số để tính toán.</em>`);
  } else {
    lines.push('<strong>Trường số:</strong>');
    Object.keys(stats.numeric).forEach(col=>{
      const s = stats.numeric[col];
      if(s.count===0){
        lines.push(`- ${escapeHtml(col)}: không có giá trị số`);
      } else {
        lines.push(`- ${escapeHtml(col)}: số lượng=${s.count} | trung bình=${round(s.avg)} | min=${s.min} | max=${s.max}`);
      }
    });
  }
  statsEl.innerHTML = lines.join('<br/>');
}

function round(v, d=2){
  return Math.round((v+Number.EPSILON)*Math.pow(10,d))/Math.pow(10,d);
}

function generateReportHtml(tableName, includeFullDb=false){
  const now = new Date();
  const stats = computeStats(tableName);
  const tbl = DB[tableName];
  let html = `<!doctype html><html lang="vi"><head><meta charset="utf-8"/><title>Báo cáo - ${tableName}</title><style>body{font-family:Arial,Helvetica,sans-serif;padding:18px}table{border-collapse:collapse;width:100%}th,td{border:1px solid #ccc;padding:6px;text-align:left}</style></head><body>`;
  html += `<h2>Báo cáo cho bảng: ${escapeHtml(tableName)}</h2>`;
  html += `<p>Thời gian tạo: ${escapeHtml(now.toLocaleString())}</p>`;
  html += `<h3>Schema</h3><pre>${escapeHtml(tbl.schema.join(', '))}</pre>`;
  html += `<h3>Thống kê</h3>`;
  html += `<pre>${escapeHtml(JSON.stringify(stats, null, 2))}</pre>`;
  html += `<h3>Danh sách bản ghi (${tbl.rows.length})</h3>`;
  html += `<table><thead><tr>${tbl.schema.map(c=>`<th>${escapeHtml(c)}</th>`).join('')}</tr></thead><tbody>`;
  tbl.rows.forEach(r=>{
    html += '<tr>';
    tbl.schema.forEach(c=>{
      const v = r[c]===null||r[c]===undefined? '': String(r[c]);
      html += `<td>${escapeHtml(v)}</td>`;
    });
    html += '</tr>';
  });
  html += '</tbody></table>';
  if(includeFullDb){
    html += '<h3>Toàn bộ DB (JSON)</h3><pre>'+escapeHtml(JSON.stringify(DB, null, 2))+'</pre>';
  }
  html += '</body></html>';
  return html;
}

function generateReportTxt(tableName){
  const now = new Date();
  const stats = computeStats(tableName);
  const tbl = DB[tableName];
  let txt = '';
  txt += `BÁO CÁO - Bảng: ${tableName}\n`;
  txt += `Thời gian tạo: ${now.toLocaleString()}\n\n`;
  txt += `Schema: ${tbl.schema.join(', ')}\n\n`;
  txt += `Thống kê:\n${JSON.stringify(stats, null, 2)}\n\n`;
  txt += `Danh sách bản ghi (${tbl.rows.length}):\n`;
  tbl.rows.forEach((r, idx)=>{
    txt += `#${idx+1} `;
    txt += tbl.schema.map(c=>`${c}=${r[c]===null||r[c]===undefined?'':r[c]}`).join(', ');
    txt += '\n';
  });
  return txt;
}

function downloadBlob(filename, content, type='text/plain'){
  const blob = new Blob([content], {type});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

document.getElementById('statsBtn').addEventListener('click', ()=>{
  const stats = computeStats(selectedTable);
  renderStatsToUI(stats);
  log('Thực hiện thống kê cho ' + selectedTable);
});

document.getElementById('generateHtmlReport').addEventListener('click', ()=>{
  const html = generateReportHtml(selectedTable, false);
  const filename = `report_${selectedTable}.html`;
  downloadBlob(filename, html, 'text/html');
  log('Tạo báo cáo HTML cho ' + selectedTable + ' (tải xuống).');
});
document.getElementById('generateTxtReport').addEventListener('click', ()=>{
  const txt = generateReportTxt(selectedTable);
  const filename = `report_${selectedTable}.txt`;
  downloadBlob(filename, txt, 'text/plain');
  log('Tạo báo cáo .txt cho ' + selectedTable + ' (tải xuống).');
});
document.getElementById('downloadDB').addEventListener('click', ()=>{
  const json = JSON.stringify(DB, null, 2);
  downloadBlob('libraryDB_backup.json', json, 'application/json');
  log('Tải bản sao DB (JSON).');
});

document.getElementById('run').addEventListener('click', ()=> runQuery(document.getElementById('query').value));
document.getElementById('sample1').addEventListener('click', ()=> document.getElementById('query').value = "SELECT * FROM MUON_TRA WHERE so_the_TV='TV001'");
document.getElementById('sample2').addEventListener('click', ()=> document.getElementById('query').value = "SELECT ma_sach,ten_sach FROM SACH");

function saveDB() {
  localStorage.setItem('libraryDB', JSON.stringify(DB));
}
function loadDB() {
  const data = localStorage.getItem('libraryDB');
  if (data) {
    try { return JSON.parse(data); } catch(e) { return null; }
  }
  return null;
}
const saved = loadDB();
if (saved) {
  Object.keys(saved).forEach(k=>{
    DB[k] = saved[k];
  });
}

renderTables();
renderMain();
log('Hệ thống quản lý thư viện sẵn sàng. Chọn bảng để bắt đầu.');
</script>
</body>
</html>